# ZK-VC: Zero-Knowledge Verifiable Credentials for Keystone TEE

è¿™æ˜¯ä¸€ä¸ªåŸºäº**é›¶çŸ¥è¯†è¯æ˜ (ZKP)** å’Œ**å¯éªŒè¯å‡­è¯ (VC)** çš„å»ä¸­å¿ƒåŒ–èº«ä»½éªŒè¯ç³»ç»Ÿï¼Œè¿è¡Œåœ¨ Keystone TEE ä¸Šã€‚

## ğŸ¯ æ ¸å¿ƒåˆ›æ–°

ä¸ä¼ ç»Ÿçš„ ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰æ¨¡å‹ä¸åŒï¼Œæœ¬ç³»ç»Ÿå®ç°äº†**çœŸæ­£çš„å»ä¸­å¿ƒåŒ–èº«ä»½éªŒè¯**ï¼š

- âŒ **ä¸å†éœ€è¦ä¸­å¿ƒåŒ–çš„æˆå‘˜åˆ—è¡¨**
- âœ… **Issuerï¼ˆå‘è¡Œæ–¹ï¼‰ç­¾å‘ VC**
- âœ… **Prover æŒæœ‰ VCï¼Œç”Ÿæˆ ZK è¯æ˜**
- âœ… **Verifier åªéªŒè¯ Issuer ç­¾åï¼Œä¸çŸ¥é“å…·ä½“èº«ä»½**

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¯ä¿¡å‘è¡Œæ–¹ (Issuer)                        â”‚
â”‚   - ç­¾å‘ Verifiable Credentials (VC)                        â”‚
â”‚   - å…¬é’¥ (issuer_public_key) æ˜¯å…¬å¼€çš„                       â”‚
â”‚   - ç§é’¥åªæœ‰ Issuer çŸ¥é“                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ ç­¾å‘ VC
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Enclave1 (Prover - æŒæœ‰ VC)                                â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  ğŸ”’ ç§å¯†æ•°æ®ï¼š                                               â”‚
â”‚     - VerifiableCredential {                                â”‚
â”‚         holder_id: "alice@company.com",                     â”‚
â”‚         role: "engineer",                                   â”‚
â”‚         issue_date: 1609459200,                             â”‚
â”‚         expiry_date: 1672531199,                            â”‚
â”‚         signature: [ç”± Issuer ç­¾å]                         â”‚
â”‚       }                                                      â”‚
â”‚                                                              â”‚
â”‚  ğŸ§® ZK æ“ä½œï¼š                                                â”‚
â”‚     - ç”Ÿæˆè¯æ˜ï¼šè¯æ˜æŒæœ‰æœ‰æ•ˆçš„ VC                            â”‚
â”‚     - ä¸æ³„éœ² VC çš„ä»»ä½•å…·ä½“å†…å®¹                               â”‚
â”‚                                                              â”‚
â”‚  âœ… VC æ°¸ä¸ç¦»å¼€ Enclave                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚   åªå‘é€ï¼šZK Proof
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Host (ä¸å¯ä¿¡çš„æ¶ˆæ¯ä¸­ç»§)                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  ğŸ“¬ æ¶ˆæ¯é˜Ÿåˆ—ï¼š                                               â”‚
â”‚     - join_request_queue                                    â”‚
â”‚     - challenge_queue                                       â”‚
â”‚     - proof_queue                                           â”‚
â”‚     - result_queue                                          â”‚
â”‚                                                              â”‚
â”‚  âœ… Host æ— æ³•è®¿é—® VC å†…å®¹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚   è½¬å‘ï¼šZK Proof
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Enclave2 (Verifier - ä¿¡ä»» Issuer)                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  ğŸ“‹ å—ä¿¡ä»»çš„ Issuer åˆ—è¡¨ï¼š                                   â”‚
â”‚     - Issuer_Public_Key_1  (Company HR)                    â”‚
â”‚     - Issuer_Public_Key_2  (Government Agency)             â”‚
â”‚                                                              â”‚
â”‚  ğŸ§® éªŒè¯é€»è¾‘ï¼š                                               â”‚
â”‚     1. ç”Ÿæˆéšæœº nonce                                        â”‚
â”‚     2. éªŒè¯ ZK proofï¼š                                       â”‚
â”‚        - VC æ˜¯ç”±å—ä¿¡ä»»çš„ Issuer ç­¾å‘                         â”‚
â”‚        - VC ç­¾åæœ‰æ•ˆ                                         â”‚
â”‚        - VC æœªè¿‡æœŸ                                           â”‚
â”‚        - proof ç»‘å®šäº† nonce                                  â”‚
â”‚                                                              â”‚
â”‚  âœ… ä¸çŸ¥é“ Prover çš„å…·ä½“èº«ä»½                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ åè®®æµç¨‹

```
Prover (E1)                Host                Verifier (E2)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚                        â”‚                       â”‚
     â”‚ 1. REQ_JOIN_GROUP â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚                       â”‚
     â”‚                        â”‚                       â”‚â—„â”€ ç”Ÿæˆ nonce
     â”‚                        â”‚                       â”‚   é€‰æ‹© trusted_issuer_key
     â”‚                        â”‚                       â”‚
     â”‚â—„â”€ 2. CHALLENGE â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  (nonce, issuer_key)   â”‚                       â”‚
     â”‚                        â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                  â”‚                       â”‚
â”‚ ç”Ÿæˆ ZKP  â”‚                  â”‚                       â”‚
â”‚ è¯æ˜å†…å®¹ï¼š â”‚                  â”‚                       â”‚
â”‚ - VC ç­¾åæœ‰æ•ˆâ”‚                 â”‚                       â”‚
â”‚ - Issuer åŒ¹é…â”‚                 â”‚                       â”‚
â”‚ - æœªè¿‡æœŸ    â”‚                  â”‚                       â”‚
â”‚ - ç»‘å®š nonceâ”‚                  â”‚                       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â”‚                       â”‚
     â”‚                        â”‚                       â”‚
     â”‚ 3. PROOF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚                       â”‚
     â”‚                        â”‚                       â”‚â—„â”€ éªŒè¯ ZKP
     â”‚                        â”‚                       â”‚   æ£€æŸ¥ nonce
     â”‚                        â”‚                       â”‚
     â”‚â—„â”€ 4. RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  (VALID/INVALID)       â”‚                       â”‚
     â”‚                        â”‚                       â”‚
```

## ğŸ” å¯éªŒè¯å‡­è¯ (VC) ç»“æ„

```rust
struct VerifiableCredential {
    // VC å…ƒæ•°æ®
    holder_id: String,       // æŒæœ‰è€…æ ‡è¯† (e.g., "alice@company.com")
    issuer: String,          // å‘è¡Œæ–¹æ ‡è¯†
    issue_date: u64,         // ç­¾å‘æ—¶é—´æˆ³
    expiry_date: u64,        // è¿‡æœŸæ—¶é—´æˆ³
    
    // VC å†…å®¹ (å¯æ‰©å±•)
    claims: Vec<(String, String)>,  // é”®å€¼å¯¹ (e.g., role="engineer")
    
    // å¯†ç å­¦ç»‘å®š
    signature: Vec<u8>,      // Issuer çš„æ•°å­—ç­¾å
}
```

**ç­¾åç®—æ³•**ï¼šEd25519ï¼ˆå¿«é€Ÿã€å®‰å…¨ã€é€‚åˆ TEEï¼‰

## ğŸ§® ZK ç”µè·¯å®šä¹‰

```rust
struct VCCircuit {
    // ç§å¯†è¾“å…¥ (Witness)
    vc_holder_id: Option<Fr>,
    vc_issue_date: Option<Fr>,
    vc_expiry_date: Option<Fr>,
    vc_signature: Option<Vec<u8>>,
    
    // å…¬å¼€è¾“å…¥ (Public Inputs)
    trusted_issuer_pubkey: Option<Vec<u8>>,
    current_timestamp: Option<Fr>,
    nonce: Option<Fr>,
}

// çº¦æŸæ¡ä»¶
impl ConstraintSynthesizer<Fr> for VCCircuit {
    fn generate_constraints(self, cs: ConstraintSystemRef<Fr>) -> Result<()> {
        // çº¦æŸ 1: VC ç­¾åæœ‰æ•ˆ
        //   verify_ed25519_signature(
        //     message = hash(vc_holder_id || vc_issue_date || vc_expiry_date),
        //     signature = vc_signature,
        //     public_key = trusted_issuer_pubkey
        //   ) == true
        
        // çº¦æŸ 2: VC æœªè¿‡æœŸ
        //   current_timestamp <= vc_expiry_date
        
        // çº¦æŸ 3: VC å·²ç”Ÿæ•ˆ
        //   vc_issue_date <= current_timestamp
        
        // çº¦æŸ 4: ç»‘å®š nonceï¼ˆé˜²é‡æ”¾ï¼‰
        //   nonce è¢«åŒ…å«åœ¨è¯æ˜ä¸­
        
        Ok(())
    }
}
```

## ğŸ†š ä¸ zkid-acl çš„å¯¹æ¯”

| ç‰¹æ€§ | zkid-acl | zkid-vc (æœ¬é¡¹ç›®) |
|------|----------|------------------|
| **æˆæƒæ¨¡å‹** | ä¸­å¿ƒåŒ– ACL | å»ä¸­å¿ƒåŒ– VC |
| **æˆå‘˜ç®¡ç†** | Verifier ç»´æŠ¤åˆ—è¡¨ | Issuer ç­¾å‘å‡­è¯ |
| **Prover æŒæœ‰** | ç§å¯† `user_id` | å®Œæ•´ VC (å«ç­¾å) |
| **ZK è¯æ˜** | `hash(user_id) == public_id` | `verify_signature(VC, issuer_pk)` |
| **Verifier å­˜å‚¨** | æ‰€æœ‰æˆå‘˜ ID | åªå­˜ Issuer å…¬é’¥ |
| **éšç§ä¿æŠ¤** | éšè— user_id | éšè—æ‰€æœ‰ VC å†…å®¹ |
| **å¯æ‰©å±•æ€§** | âŒ éœ€æ‰‹åŠ¨æ·»åŠ æˆå‘˜ | âœ… Issuer è‡ªä¸»ç­¾å‘ |
| **åŠé”€æœºåˆ¶** | âŒ éœ€ä» ACL åˆ é™¤ | âœ… å¯å®ç° CRL/çŠ¶æ€åˆ—è¡¨ |

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1ï¸âƒ£ å»ä¸­å¿ƒåŒ–
- **Verifier ä¸æ§åˆ¶æˆå‘˜èµ„æ ¼**
- **Issuer è´Ÿè´£ç­¾å‘å‡­è¯**
- **å®ç°æˆæƒä¸éªŒè¯çš„åˆ†ç¦»**

### 2ï¸âƒ£ å®Œå…¨é›¶çŸ¥è¯†
- **Prover ä¸æ³„éœ²èº«ä»½ä¿¡æ¯**
- **Verifier åªçŸ¥é“"Prover æŒæœ‰æœ‰æ•ˆ VC"**
- **æ— æ³•å­¦åˆ° holder_idã€role ç­‰å…·ä½“å†…å®¹**

### 3ï¸âƒ£ é˜²ç¯¡æ”¹
- **VC ç”± Issuer æ•°å­—ç­¾å**
- **ä»»ä½•ç¯¡æ”¹ä¼šå¯¼è‡´ç­¾åéªŒè¯å¤±è´¥**
- **ZK ç”µè·¯å†…éƒ¨éªŒè¯ç­¾å**

### 4ï¸âƒ£ é˜²é‡æ”¾
- **æ¯æ¬¡è®¤è¯ä½¿ç”¨æ–°çš„ nonce**
- **proof ç»‘å®š nonce**
- **æ—§è¯æ˜æ— æ³•é‡ç”¨**

### 5ï¸âƒ£ æ—¶æ•ˆæ€§
- **VC åŒ…å«è¿‡æœŸæ—¶é—´**
- **ZK ç”µè·¯éªŒè¯æ—¶é—´æˆ³**
- **è¿‡æœŸ VC æ— æ³•ç”Ÿæˆæœ‰æ•ˆè¯æ˜**

## ğŸ—ï¸ æ„å»ºæŒ‡å—

### å‰ç½®è¦æ±‚

- **Rust 1.70+**
- **Keystone SDK**
- **RISC-V toolchain**
- **CMake 3.10+**

### æ„å»ºæ­¥éª¤

```bash
# å…‹éš†è¯¥ä»“åº“åˆ°æœ¬åœ°
git clone -b zkid-vc --single-branch https://github.com/qiran27/zk-auth-keystone.git

# æŠŠæ–‡ä»¶æ‹·è´åˆ°keystone/examplesç›®å½•ä¸‹
cp -r zkid-vc /path/to/keystone/examples

# è¿›å…¥åˆ°zkid-acl/zklibç›®å½•ä¸‹æ‰§è¡Œç¼–è¯‘rusté›¶çŸ¥è¯†è¯æ˜åº“
cd /path/to/keystone/examples/zkid-vc/zklib/build-zklib.sh
chmod 777 ./build-zklib.sh
./build-zklib.sh

## ğŸš€ Running

### On Keystone System

# è¿›å…¥åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•
cd /usr/share/keystone/examples

# æ‰§è¡Œæµ‹è¯•ç¨‹åº
./zkid-vc.ke
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1ï¸âƒ£ ä¼ä¸šè®¿é—®æ§åˆ¶
- **å‘˜å·¥æŒæœ‰ HR ç­¾å‘çš„å‘˜å·¥è¯**
- **è®¿é—®å†…éƒ¨æœåŠ¡æ—¶å‡ºç¤º ZK è¯æ˜**
- **æœåŠ¡åªéªŒè¯ HR ç­¾åï¼Œä¸çŸ¥é“å…·ä½“å‘˜å·¥ä¿¡æ¯**

### 2ï¸âƒ£ æ•°å­—è¯ä¹¦éªŒè¯
- **ç”¨æˆ·æŒæœ‰æ”¿åºœç­¾å‘çš„æ•°å­—èº«ä»½è¯**
- **è¯æ˜å¹´é¾„ >18 è€Œä¸æ³„éœ²å‡ºç”Ÿæ—¥æœŸ**
- **è¯æ˜å›½ç±è€Œä¸æ³„éœ²å§“åã€åœ°å€**

### 3ï¸âƒ£ å­¦å†è®¤è¯
- **æ¯•ä¸šç”ŸæŒæœ‰å­¦æ ¡ç­¾å‘çš„å­¦å†è¯ä¹¦**
- **æ±‚èŒæ—¶è¯æ˜å­¦å†è€Œä¸æ³„éœ²æˆç»©**
- **é›‡ä¸»åªéªŒè¯å­¦æ ¡ç­¾å**

### 4ï¸âƒ£ åŒ»ç–—æ•°æ®å…±äº«
- **æ‚£è€…æŒæœ‰åŒ»é™¢ç­¾å‘çš„å¥åº·è¯æ˜**
- **è¯æ˜ç–«è‹—æ¥ç§è€Œä¸æ³„éœ²ç—…å²**
- **ä¿æŠ¤åŒ»ç–—éšç§**

### 5ï¸âƒ£ ä¾›åº”é“¾ç®¡ç†
- **ä¾›åº”å•†æŒæœ‰è®¤è¯æœºæ„ç­¾å‘çš„èµ„è´¨è¯ä¹¦**
- **è¯æ˜åˆè§„æ€§è€Œä¸æ³„éœ²å•†ä¸šæœºå¯†**
- **ç®€åŒ–èµ„è´¨å®¡æŸ¥æµç¨‹**

## ğŸ“š æŠ€æœ¯å‚è€ƒ

- [W3C Verifiable Credentials Data Model](https://www.w3.org/TR/vc-data-model/)
- [Ed25519 Digital Signature](https://ed25519.cr.yp.to/)
- [arkworks - ZK Circuit Library](https://github.com/arkworks-rs)
- [Keystone TEE Documentation](https://docs.keystone-enclave.org/)

## ğŸ¤ ä¸ zkid-acl çš„å…³ç³»

æœ¬é¡¹ç›®æ˜¯ `zkid-acl` çš„**è¿›åŒ–ç‰ˆæœ¬**ï¼š
- **å…±äº«ç›¸åŒçš„åº•å±‚åŸºç¡€è®¾æ–½**ï¼ˆHostã€ZK åº“ã€Eyrie runtimeï¼‰
- **å®ç°æ›´å…ˆè¿›çš„èº«ä»½éªŒè¯æ¨¡å‹**
- **ä»£ç ç»“æ„ä¿æŒä¸€è‡´**ï¼Œä¾¿äºå¯¹æ¯”å­¦ä¹ 

## ğŸ“„ è®¸å¯è¯

æœ¬ç¤ºä¾‹æ˜¯ Keystone é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œéµå¾ªç›¸åŒçš„è®¸å¯è¯ã€‚

---

**Built with â¤ï¸ for Decentralized Identity and Zero-Knowledge Proofs**


